# npm run dev MCP サーバー - 要件仕様書

## 概要
現在のプロジェクトまたはモノレポ内のサブディレクトリのnpm run devコマンドを管理するMCPサーバーを作成する。

## 機能要件

### 1. プロジェクト検出とディレクトリ管理
- **F1.1** 現在のディレクトリからpackage.jsonを検索し、devスクリプトが定義されているディレクトリを特定できること
- **F1.2** モノレポの場合、サブディレクトリのpackage.jsonからdevスクリプトを検出できること
- **F1.3** 複数のpackage.jsonが見つかった場合、適切なディレクトリを選択またはユーザーに選択肢を提示できること
- **F1.4** .envファイルを検出し、環境変数を適用できること

### 2. npm run dev プロセス管理
- **F2.1** 指定されたディレクトリでnpm run devコマンドをバックグラウンドで実行できること
- **F2.2** 既にnpm run devプロセスが起動している場合は、新しいプロセスを起動せず既存のプロセスを使用すること
- **F2.3** プロセスの起動状態を確認できること

### 3. ポート情報取得
- **F3.1** npm run devが使用している起動ポートを取得できること
- **F3.2** 複数のポートを使用している場合は、全てのポートを取得できること

### 4. ログ管理
- **F4.1** npm run devプロセスのログを取得できること
- **F4.2** リアルタイムでログを監視できること
- **F4.3** ログの履歴を保持し、必要に応じて過去のログを取得できること

### 5. プロセス制御
- **F5.1** npm run devプロセスを停止できること
- **F5.2** プロセスの再起動ができること

## 非機能要件

### 1. パフォーマンス
- **NF1.1** プロセス起動確認は3秒以内に完了すること
- **NF1.2** ログ取得は1秒以内に開始されること

### 2. 信頼性
- **NF2.1** プロセスが異常終了した場合でも、MCPサーバー自体は継続動作すること
- **NF2.2** プロセス状態の確認は正確であること

### 3. 使いやすさ
- **NF3.1** MCPツールとして標準的なインターフェースを提供すること
- **NF3.2** エラーメッセージは分かりやすく、問題解決に役立つ情報を含むこと

## 制約事項

### 1. 技術制約
- **C1.1** TypeScriptで実装すること
- **C1.2** MCP標準仕様に準拠すること
- **C1.3** Node.jsランタイムで動作すること

### 2. 環境制約
- **C2.1** package.jsonにdevスクリプトが定義されているディレクトリで実行すること
- **C2.2** モノレポの場合は適切なサブディレクトリを検出して実行すること
- **C2.3** .envファイルが存在する場合は環境変数として読み込むこと

## MCPツール仕様

### 1. scan_project_dirs
- **説明**: プロジェクト内のpackage.jsonとdevスクリプトを検索
- **戻り値**: 利用可能なディレクトリリスト、devスクリプト情報

### 2. start_dev_server
- **説明**: 指定ディレクトリでnpm run devをバックグラウンドで開始
- **パラメータ**: directory（オプション、未指定時は自動検出）
- **戻り値**: プロセス状態、ポート情報

### 3. get_dev_status  
- **説明**: npm run devプロセスの状態確認
- **戻り値**: 起動状態、PID、ポート情報、実行ディレクトリ

### 4. get_dev_logs
- **説明**: npm run devのログ取得
- **パラメータ**: lines（取得行数、オプション）
- **戻り値**: ログ内容

### 5. stop_dev_server
- **説明**: npm run devプロセス停止
- **戻り値**: 停止結果

### 6. restart_dev_server
- **説明**: npm run devプロセス再起動
- **戻り値**: 再起動結果、ポート情報